<!DOCTYPE html>
<html>
<head>
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css">

    <!-- Optional theme -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap-theme.min.css">

    <script src="https://code.jquery.com/jquery-2.1.3.min.js"/>
    <!-- Latest compiled and minified JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/js/bootstrap.min.js"></script>
    <title>Time Sheet</title>

    <script type="text/javascript">
        $(document).ready(function () {


            var hours = 0, minutes = 0, second = 0, t;
            var timeOn = false;
            for (var min = 0; min < localStorage.length; min++) {
                var data = JSON.parse(localStorage.getItem('member' + min) || {})

                $("#dataTable").find('tbody')
                        .append($('<tr>')
                                .append($('<td>')
                                        .text(data.contactName))
                                .append($('<td>')
                                        .text(data.clientname))
                                .append($('<td>')
                                        .text(data.startTime))
                                .append($('<td>')
                                        .text(data.endTime))
                                .append($('<td>')
                                        .text(data.totalTime))
                        )

            }


        });

            $('#icon').click(function () {

                function stopWatch() {

                    second++;
                    if (second >= 60) {
                        second = 0;
                        minutes++;
                        if (minutes >= 60) {
                            minutes = 0;
                            hours++;
                        }
                    }


                    count();
                }

                //End stopwatch function

                function count() {
                    t = setTimeout(stopWatch, 1000); //Iterate the stopWatch function every second (realtime);

                }

                //End count function

                if (timeOn != true)
                    timeOn = true;
                else
                    timeOn = false;
                //If clicked, set timeOn to true.  If clicked when checked, set it to false.

                var date = new Date,
                        day = date.getDate(),
                        month = date.getMonth() + 1,
                        year = date.getFullYear(),
                        hour = date.getHours(),
                        minute = date.getMinutes(),
                        seconds = date.getSeconds(),
                        ampm = hour > 12 ? "PM" : "AM";

                hour = hour % 12;
                hour = hour ? hour : 12; // zero = 12

                minute = minute > 9 ? minute : "0" + minute;
                seconds = seconds > 9 ? seconds : "0" + seconds;
                hour = hour > 9 ? hour : "0" + hour;
                var time = hour + ":" + minute + " " + ampm;
                //Visual time display

                if (timeOn === false) {
                    $('#endTime').val(time);
                    clearTimeout(t);
                }
                else {
                    $('#startTime').val(time);
                    second = seconds;
                    count();
                }
                //End all time functions
            var i = 0;
                $('#total').unbind('click').click(function () {
                    var totalTime = (hours ? (hours > 9 ? hours : "0" + hours) : "00") + ":" + (minutes ? (minutes > 9 ? minutes : "0" + minutes) : "00");
                    console.log(minutes);
                    console.log(totalTime);
                    $('#totalTime').val(totalTime);

                    $("#timeTable").find('tbody')
                            .append($('<tr>')
                                    .append($('<td>')
                                            .text($('#clientName').val()))
                                    .append($('<td>')
                                            .text($('#contactName').val()))
                                    .append($('<td>')
                                            .text($('#startTime').val()))
                                    .append($('<td>')
                                            .text($('#endTime').val()))
                                    .append($('<td>')
                                            .text($('#totalTime').val()))
                    );
                    var data =
                    {
                        clientname  :  $('#clientName').val(),
                        contactname :  $('#contactName').val(),
                        starttime   :  $('#startTime').val(),
                        endtime     :  $('#endTime').val(),
                        totaltime   :  $('#totalTIme').val(),

                    }
                    localStorage["timeentry"+i] = JSON.stringify(data);
                    i++;

                    $('#clientName').val('')
                    $('#contactName').val('')
                    $('#startTime').val('')
                    $('#endTime').val('')
                    $('#totalTime').val('')

                    hours, second, minutes = 0;

                })

            });
        });
        window.onbeforeunload = function (event) {
            var message = "Your data will not be saved if you close now.  Are you sure?";
            if (typeof event == 'undefined') {
                event = window.event;
            }
            if (event) {
                event.returnValue = message;
            }
            return message;
        }
        //        function savedata() {
        //            localStorage.mydata = $('#timeTable').html();
        //            alert('Data Saved!'); //This is not showing up
        //        }
    </script>
    <style>#icon {
        padding: 10px;
        background-color: #325d88;
        color: #fff;
        text-decoration: none;
        border: 0;
    }</style>
</head>
<body>
<div class="row">
    <div class="col-md-4 col-md-offset-4">
        <div class="form-group">
            <label class="col-sm-2 control-label" for="clientName">Client Name</label>

            <div class="col-sm-4">
                <input type="text" placeholder="Client Name" id="clientName" class="form-control" name="clientName">
            </div>

            <label class="col-sm-2 control-label" for="contactName">Contact Name</label>

            <div class="col-sm-4">
                <input type="text" placeholder="Contact Name" id="contactName" class="form-control" name="contactName">
            </div>
        </div>
        <br/>

        <div class="form-group">
            <br/>
            <br/>
            <label class="col-sm-2 control-label" for="startTime">Start Time</label>

            <div class="col-sm-4">
                <input type="text" placeholder="12:00" class="form-control" id="startTime" name="startTime">
            </div>
            <label class="col-sm-2 control-label" for="endTime">End Time</label>

            <div class="col-sm-4">
                <input type="text" placeholder="1:00" class="form-control" id="endTime" name="endTime">
            </div>
        </div>
        <br>
        <br>
        <button class="glyphicon glyphicon-off" id="icon"></button>

        <button type="button" class="btn btn-default" id="total">Save Time</button>

        <label class="col-sm-2 control-label" for="totalTime">Total Time</label>

        <div class="col-sm-4">
            <input type="text" placeholder="00:00" class="form-control" id="totalTime" name="totalTime">
        </div>
        <br/>
    </div>
</div>
<br/>
<br/>
<br/>
<hr/>
<div class="container">
    <table class="table table-striped" id="timeTable">
        <thead>
        <tr>
            <th>Client Name</th>

            <th>Contact Name</th>

            <th>Start Time</th>

            <th>End TIme</th>

            <th>Total Time</th>
        </tr>
        </thead>

        <tbody>

        </tbody>
    </table>
</div>
</body>
</html>